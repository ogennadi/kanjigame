<script>
  $(document).ready(function() {
    var time_left         = 30;
    var word_list         = [{'word': '原子',   'reading': 'genko',  'meaning': 'atom'},
                             {'word': '一部分', 'reading': 'ibubun', 'meaning': 'part'}];
    var character_list    = ['一' ,'分' ,'部' ,'子','原']
    var word_found_array  = init_word_found_array(word_list);

    
    setup_board(word_list);      

    function setup_board(list) {
      // start timer
      var timer = setInterval(function(){
        if (time_left == 0){
          stop_timer();
          end_game();
          return;
        }
        
        time_left--;
        $('#timer').text(time_left);
      }, 1000);
      
      // grid of individual kanji
      for (var i = 0; i < character_list.length; i++){
        $('#board').append('<button id="'+ i +'" class="control">'+ character_list[i] +'</button>');
      }
      
      // list of found words
      for (var i = 0; i < list.length; i++) {
        $('#wordlist').append('<li id="w'+ i +'">'+ mask_word(list[i].word) +'</li>');
      }
      
      // kanji buttons clickable
      $('#board button').click(function(event){
        click_kanji(event.target.id);
      });
    
      // check button clickable
      $('#check').click(function(){
        check();
      });
    }
    
    function click_kanji(id) {
      clicked_kanji = document.getElementById(id);
      
      if (hasClass(clicked_kanji, "clicked")) {
        return;
      }
      
      clicked_kanji.className += " clicked";
      
      selected_paragraph = document.getElementById("selected");
      selected_paragraph.innerHTML = selected_paragraph.innerHTML + clicked_kanji.innerHTML;
    }
    
    function hasClass(element, cls) {
      return (' ' + element.className + ' ').indexOf(' ' + cls + ' ') > -1;
    }
    
    function check() {
      $('#board button').removeClass('clicked');
      check_text = $('p#selected').text();
      $('p#selected').text('');
      
      for (var i = 0; i < word_list.length; i++) {          
        if (word_list[i].word.length == check_text.length && word_list[i].word == check_text) {
          $('#wordlist #w' + i).text(word_list[i].word + ', ' +
                                     word_list[i].reading + ', ' +
                                     word_list[i].meaning);
          word_found_array[i] = true;
          set_status ('found word: ' + word_list[i].word);
          break;
        }
      }
      
      if (end_condition()){
        end_game();
      }
    }
    
    // returns true if the game has been won or lost
    function end_condition() {
      for(var i = 0; i < word_found_array.length; i++){
        if (!word_found_array[i]){
          return false;
        }
      }
      
      return true;
    }
    
    // returns a new array with all elements set to v
    function init_word_found_array(word_list) {
      ret = Array(word_list.length);
      for (var i = 0; i < word_list.length; i++){
        ret[i] = false;
      }
      
      return ret;
    }
    
    function end_game() {
      $('.control').attr('disabled', '');
      stop_timer();
      set_status('Game over');
    }
    
    function set_status(text) {
      $('#status').text(text);
    }
    
    function stop_timer() {
      clearInterval(timer);
    }

    
    function mask_word(word){
      var display = Array(word.length);
      
      for(var i = 0; i < display.length; i++ ){
        display[i] = '_';
      }
      
      return display.join(' ');
    }   
});
</script>

<p id="status">Game in progress</p>

<p>Time left <span id="timer">-:--</span></p>

<div id="board">
  <h3>Board</h3>
  <!-- <button id="0" class="control">一</button> -->
</div>

<button id="check" class="control">Check</button>

<h3>Selected</h3>

<p id="selected"></p>

<h3>Found</h3>
<ol id="wordlist">
  <!-- <li id="w0">_ _</li> -->
</ol>

<button onclick="location.reload()">New Game</button>
